<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shared Meeting - Legal Memo</title>
  <meta name="description" content="View shared meeting recording and transcript">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0f1219 0%, #1a1f2e 100%);
      color: #e5e7eb;
      line-height: 1.6;
      min-height: 100vh;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Loading State */
    .loading-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid #2d3548;
      border-top-color: #6366f1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: #9ca3af;
      font-size: 14px;
    }
    
    /* Error State */
    .error-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      text-align: center;
    }
    
    .error-icon {
      width: 80px;
      height: 80px;
      background: rgba(239, 68, 68, 0.15);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
    }
    
    .error-icon svg {
      width: 40px;
      height: 40px;
      color: #ef4444;
    }
    
    .error-title {
      font-size: 24px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 12px;
    }
    
    .error-message {
      font-size: 16px;
      color: #9ca3af;
      max-width: 400px;
    }
    
    /* Password Form */
    .password-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    
    .password-card {
      background: rgba(30, 36, 51, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      width: 100%;
      max-width: 420px;
      border: 1px solid rgba(99, 102, 241, 0.2);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }
    
    .lock-icon {
      width: 72px;
      height: 72px;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 28px;
    }
    
    .lock-icon svg {
      width: 36px;
      height: 36px;
      color: #818cf8;
    }
    
    .password-title {
      font-size: 22px;
      font-weight: 700;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
    }
    
    .password-subtitle {
      font-size: 14px;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 28px;
    }
    
    .password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .password-input {
      background: #252b3d;
      border: 2px solid #374151;
      border-radius: 14px;
      padding: 16px 18px;
      font-size: 16px;
      color: #ffffff;
      width: 100%;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    
    .password-input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }
    
    .password-input::placeholder {
      color: #6b7280;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border: none;
      border-radius: 14px;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
    }
    
    .submit-btn:active {
      transform: translateY(0);
    }
    
    .submit-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }
    
    .password-error {
      color: #f87171;
      font-size: 14px;
      text-align: center;
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 10px;
    }
    
    /* Meeting Content */
    .meeting-content {
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .header {
      margin-bottom: 32px;
    }
    
    .meeting-title {
      font-size: 32px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 20px;
      line-height: 1.2;
    }
    
    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #9ca3af;
      font-size: 14px;
    }
    
    .meta-item svg {
      width: 18px;
      height: 18px;
      color: #6b7280;
    }
    
    .duration-badge {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
      color: #a5b4fc;
      padding: 8px 16px;
      border-radius: 24px;
      font-weight: 600;
      font-size: 14px;
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .type-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
    }
    
    .type-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    
    .contact-info {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #2d3548;
    }
    
    .contact-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 15px;
      color: #ffffff;
    }
    
    .contact-name {
      font-size: 15px;
      color: #ffffff;
      font-weight: 500;
    }
    
    .card {
      background: rgba(30, 36, 51, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 24px;
      border: 1px solid #2d3548;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .section-title svg {
      width: 22px;
      height: 22px;
      color: #818cf8;
    }
    
    .summary-text {
      font-size: 16px;
      color: #d1d5db;
      line-height: 1.8;
    }
    
    /* Audio Player */
    .audio-section {
      margin-bottom: 24px;
    }
    
    .audio-player {
      background: rgba(30, 36, 51, 0.8);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 24px;
      display: flex;
      align-items: center;
      gap: 20px;
      border: 1px solid #2d3548;
    }
    
    .play-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      transition: transform 0.2s, box-shadow 0.2s;
      flex-shrink: 0;
    }
    
    .play-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    }
    
    .play-btn:active {
      transform: scale(0.95);
    }
    
    .progress-container {
      flex: 1;
      cursor: pointer;
      padding: 12px 0;
    }
    
    .progress-bar {
      height: 8px;
      background: #374151;
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
      width: 0%;
      transition: width 0.1s linear;
      border-radius: 4px;
    }
    
    .time-display {
      font-size: 13px;
      color: #9ca3af;
      white-space: nowrap;
      min-width: 100px;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    
    /* Transcript Segments */
    .transcript-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .segment-card {
      display: flex;
      background: #252b3d;
      border-radius: 14px;
      overflow: hidden;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
    }
    
    .segment-card:hover {
      background: #2d3548;
      transform: translateX(4px);
    }
    
    .segment-card.active {
      background: #2d3548;
      box-shadow: 0 0 0 2px #6366f1;
    }
    
    .segment-accent {
      width: 5px;
      flex-shrink: 0;
    }
    
    .segment-content {
      padding: 18px;
      flex: 1;
    }
    
    .segment-speaker {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }
    
    .segment-text {
      font-size: 15px;
      color: #e5e7eb;
      line-height: 1.7;
      margin-bottom: 10px;
    }
    
    .segment-time {
      font-size: 11px;
      color: #6b7280;
    }
    
    .full-text {
      font-size: 15px;
      color: #d1d5db;
      line-height: 1.8;
      white-space: pre-wrap;
    }
    
    .no-data {
      color: #6b7280;
      font-style: italic;
      text-align: center;
      padding: 40px;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 32px;
      color: #6b7280;
      font-size: 13px;
      border-top: 1px solid #2d3548;
      margin-top: 48px;
    }
    
    .footer strong {
      color: #818cf8;
    }
    
    /* Print Styles */
    @media print {
      body {
        background: #ffffff;
        color: #000000;
      }
      .audio-section, .footer {
        display: none;
      }
      .card {
        break-inside: avoid;
        border: 1px solid #e5e7eb;
        background: #ffffff;
      }
      .segment-card {
        break-inside: avoid;
      }
    }
    
    /* Mobile Responsive */
    @media (max-width: 640px) {
      .container {
        padding: 16px;
      }
      .meeting-title {
        font-size: 24px;
      }
      .audio-player {
        flex-wrap: wrap;
        gap: 16px;
      }
      .progress-container {
        order: 3;
        width: 100%;
      }
      .time-display {
        order: 2;
      }
      .password-card {
        padding: 28px 20px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Loading State -->
    <div id="loading" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading meeting...</p>
    </div>
  </div>

  <script>
    // Configuration - UPDATE THIS URL for your project
    const API_BASE_URL = 'https://jaepslscnnjtowwkiudu.supabase.co/functions/v1/shared-meeting';
    
    // Helper functions
    function formatDuration(seconds) {
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      if (hrs > 0) {
        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
      });
    }
    
    function formatTimestamp(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function getSpeakerColor(speaker) {
      const s = speaker.toUpperCase();
      if (s.includes('A') || s.endsWith('A')) return '#3b82f6';
      if (s.includes('B') || s.endsWith('B')) return '#ef4444';
      if (s.includes('C') || s.endsWith('C')) return '#8b5cf6';
      if (s.includes('D') || s.endsWith('D')) return '#10b981';
      return '#f59e0b';
    }
    
    // Render functions
    function renderError(title, message) {
      document.getElementById('app').innerHTML = `
        <div class="error-container">
          <div class="error-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <h1 class="error-title">${escapeHtml(title)}</h1>
          <p class="error-message">${escapeHtml(message)}</p>
        </div>
      `;
    }
    
    function renderPasswordForm(token, errorMsg = '') {
      document.getElementById('app').innerHTML = `
        <div class="password-container">
          <div class="password-card">
            <div class="lock-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <h1 class="password-title">Password Protected</h1>
            <p class="password-subtitle">This meeting requires a password to view</p>
            ${errorMsg ? `<p class="password-error">${escapeHtml(errorMsg)}</p>` : ''}
            <form class="password-form" onsubmit="submitPassword(event, '${token}')">
              <input 
                type="password" 
                id="passwordInput"
                class="password-input" 
                placeholder="Enter password" 
                required 
                autofocus
              />
              <button type="submit" class="submit-btn" id="submitBtn">View Meeting</button>
            </form>
          </div>
        </div>
      `;
    }
    
    function renderMeeting(data) {
      const { meeting, transcript, segments, meetingType, contact, audioUrl } = data;
      
      // Generate transcript HTML
      let transcriptHtml = '';
      if (segments && segments.length > 0) {
        transcriptHtml = segments.map((seg, i) => `
          <div class="segment-card" data-start="${seg.startMs}" onclick="seekTo(${seg.startMs})">
            <div class="segment-accent" style="background: ${getSpeakerColor(seg.speaker)}"></div>
            <div class="segment-content">
              <div class="segment-speaker" style="color: ${getSpeakerColor(seg.speaker)}">${escapeHtml(seg.speaker)}</div>
              <div class="segment-text">${escapeHtml(seg.text)}</div>
              <div class="segment-time">${formatTimestamp(seg.startMs)}</div>
            </div>
          </div>
        `).join('');
      } else if (transcript && transcript.fullText) {
        transcriptHtml = `<p class="full-text">${escapeHtml(transcript.fullText)}</p>`;
      } else {
        transcriptHtml = '<p class="no-data">No transcript available</p>';
      }
      
      // Generate audio player HTML
      const audioHtml = audioUrl ? `
        <section class="audio-section">
          <div class="audio-player">
            <audio id="audio" src="${escapeHtml(audioUrl)}" preload="metadata"></audio>
            <button class="play-btn" id="playBtn" onclick="togglePlay()">
              <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              <svg id="pauseIcon" style="display:none" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
              </svg>
            </button>
            <div class="progress-container" onclick="seek(event)">
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
              </div>
            </div>
            <span class="time-display" id="timeDisplay">0:00 / ${formatDuration(meeting.durationSeconds)}</span>
          </div>
        </section>
      ` : '';
      
      document.getElementById('app').innerHTML = `
        <div class="container">
          <div class="meeting-content">
            <header class="header">
              <h1 class="meeting-title">${escapeHtml(meeting.title)}</h1>
              <div class="meta-row">
                <span class="duration-badge">${formatDuration(meeting.durationSeconds)}</span>
                <div class="meta-item">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  ${formatDate(meeting.recordedAt || meeting.createdAt)}
                </div>
                ${meetingType ? `
                  <div class="type-badge" style="background: ${meetingType.color}20; color: ${meetingType.color}">
                    <span class="type-dot" style="background: ${meetingType.color}"></span>
                    ${escapeHtml(meetingType.name)}
                  </div>
                ` : ''}
              </div>
              ${contact ? `
                <div class="contact-info">
                  <div class="contact-avatar">${escapeHtml((contact.firstName[0] || '') + (contact.lastName?.[0] || ''))}</div>
                  <span class="contact-name">${escapeHtml(contact.firstName)}${contact.lastName ? ' ' + escapeHtml(contact.lastName) : ''}</span>
                </div>
              ` : ''}
            </header>
            
            ${audioHtml}
            
            ${transcript && transcript.summary ? `
              <section class="card">
                <h2 class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  Summary
                </h2>
                <p class="summary-text">${escapeHtml(transcript.summary)}</p>
              </section>
            ` : ''}
            
            <section class="card">
              <h2 class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                </svg>
                Transcript
              </h2>
              <div class="transcript-section">
                ${transcriptHtml}
              </div>
            </section>
          </div>
          
          <footer class="footer">
            Shared via <strong>Legal Memo</strong>
          </footer>
        </div>
      `;
      
      // Set up audio player if present
      if (audioUrl) {
        setupAudioPlayer(meeting.durationSeconds);
      }
      
      // Update page title
      document.title = `${meeting.title} - Shared Meeting`;
    }
    
    // Audio player functions
    function setupAudioPlayer(durationSeconds) {
      const audio = document.getElementById('audio');
      const playIcon = document.getElementById('playIcon');
      const pauseIcon = document.getElementById('pauseIcon');
      const progressFill = document.getElementById('progressFill');
      const timeDisplay = document.getElementById('timeDisplay');
      
      audio.addEventListener('play', () => {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      });
      
      audio.addEventListener('pause', () => {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      });
      
      audio.addEventListener('timeupdate', () => {
        const progress = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = progress + '%';
        timeDisplay.textContent = formatDuration(Math.floor(audio.currentTime)) + ' / ' + formatDuration(audio.duration || durationSeconds);
        
        // Highlight active segment
        const currentMs = audio.currentTime * 1000;
        document.querySelectorAll('.segment-card').forEach(seg => {
          const startMs = parseInt(seg.dataset.start);
          const nextSeg = seg.nextElementSibling;
          const endMs = nextSeg ? parseInt(nextSeg.dataset.start) : Infinity;
          
          if (currentMs >= startMs && currentMs < endMs) {
            seg.classList.add('active');
          } else {
            seg.classList.remove('active');
          }
        });
      });
    }
    
    window.togglePlay = function() {
      const audio = document.getElementById('audio');
      if (audio.paused) {
        audio.play();
      } else {
        audio.pause();
      }
    };
    
    window.seek = function(e) {
      const audio = document.getElementById('audio');
      const rect = e.currentTarget.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      audio.currentTime = percent * audio.duration;
    };
    
    window.seekTo = function(ms) {
      const audio = document.getElementById('audio');
      if (audio) {
        audio.currentTime = ms / 1000;
        audio.play();
      }
    };
    
    // API functions
    async function fetchMeetingData(token, password = null) {
      const options = {
        method: password ? 'POST' : 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      };
      
      if (password) {
        options.body = JSON.stringify({ password });
      }
      
      const response = await fetch(`${API_BASE_URL}?token=${encodeURIComponent(token)}`, options);
      return response.json();
    }
    
    window.submitPassword = async function(event, token) {
      event.preventDefault();
      const password = document.getElementById('passwordInput').value;
      const submitBtn = document.getElementById('submitBtn');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Verifying...';
      
      try {
        const data = await fetchMeetingData(token, password);
        
        if (data.error) {
          renderPasswordForm(token, data.message);
        } else if (data.success) {
          renderMeeting(data);
        }
      } catch (err) {
        renderPasswordForm(token, 'Connection error. Please try again.');
      }
    };
    
    // Initialize
    async function init() {
      // Get token from URL
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      
      if (!token) {
        renderError('Invalid Link', 'No share token provided. Please check the link and try again.');
        return;
      }
      
      try {
        const data = await fetchMeetingData(token);
        
        if (data.error) {
          const errorMessages = {
            'INVALID_TOKEN': 'No share token provided. Please check the link and try again.',
            'NOT_FOUND': 'This share link does not exist or has been removed.',
            'DEACTIVATED': 'This share link has been deactivated by the owner.',
            'EXPIRED': 'This share link has expired.',
            'MEETING_NOT_FOUND': 'The meeting associated with this link no longer exists.',
            'INTERNAL_ERROR': 'An unexpected error occurred. Please try again later.',
          };
          renderError('Error', errorMessages[data.error] || data.message);
        } else if (data.requiresPassword) {
          renderPasswordForm(token);
        } else if (data.success) {
          renderMeeting(data);
        }
      } catch (err) {
        console.error('Failed to load meeting:', err);
        renderError('Connection Error', 'Unable to load the meeting. Please check your internet connection and try again.');
      }
    }
    
    // Start the app
    init();
  </script>
</body>
</html>

